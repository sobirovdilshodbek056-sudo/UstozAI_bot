<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="UstozAI - Test natijalari va tahlil">
    <title>Natijalar - UstozAI</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-logo">
                <span>üéì</span>
                UstozAI
            </a>
            <ul class="navbar-menu">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="chat.html">AI Chat</a></li>
                <li><a href="tests.html">Testlar</a></li>
                <li><a href="subscription.html">Obuna</a></li>
            </ul>
            <div class="navbar-cta">
                <button onclick="logout()" class="btn btn-secondary btn-sm">Chiqish</button>
            </div>
        </div>
    </nav>

    <!-- Results Section -->
    <section class="section" style="min-height: 100vh; padding-top: 100px;">
        <div class="container" style="max-width: 1000px;">
            <!-- Results Header -->
            <div class="card card-gradient text-center" style="margin-bottom: var(--spacing-2xl);" id="resultsHeader">
                <div style="font-size: 5rem; margin-bottom: var(--spacing-md);" id="resultEmoji">üéâ</div>
                <h1 id="resultTitle">Test yakunlandi!</h1>
                <div style="font-size: var(--font-size-5xl); font-weight: 800; margin: var(--spacing-xl) 0;">
                    <span class="text-gradient" id="scoreDisplay">0%</span>
                </div>
                <p style="font-size: var(--font-size-lg); color: var(--text-secondary);" id="resultMessage">
                    Ajoyib natija!
                </p>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-3" style="margin-bottom: var(--spacing-2xl);">
                <div class="stat-card">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">To'g'ri javoblar</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="wrongCount">0</div>
                    <div class="stat-label">Noto'g'ri javoblar</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">Jami savollar</div>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="card" style="margin-bottom: var(--spacing-2xl);">
                <h2 style="margin-bottom: var(--spacing-xl);">üìã Batafsil tahlil</h2>
                <div id="detailedResults"></div>
            </div>

            <!-- Actions -->
            <div class="grid grid-2">
                <a href="tests.html" class="btn btn-outline btn-lg" style="justify-content: center;">
                    üîÑ Yana test topshirish
                </a>
                <a href="dashboard.html" class="btn btn-primary btn-lg" style="justify-content: center;">
                    üè† Dashboardga qaytish
                </a>
            </div>
        </div>
    </section>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!AppState.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            // Get result index from URL
            const urlParams = new URLSearchParams(window.location.search);
            const index = parseInt(urlParams.get('index'));

            if (isNaN(index) || index < 0 || index >= AppState.testResults.length) {
                showNotification('Natija topilmadi!', 'error');
                window.location.href = 'tests.html';
                return;
            }

            // Load and display results
            displayResults(AppState.testResults[index]);
        });

        function displayResults(result) {
            // Update header
            const score = result.score;
            let emoji, title, message;

            if (score >= 90) {
                emoji = 'üèÜ';
                title = 'Ajoyib!';
                message = 'Siz mukammal natija ko\'rsatdingiz!';
            } else if (score >= 80) {
                emoji = 'üéâ';
                title = 'Zo\'r!';
                message = 'Juda yaxshi natija!';
            } else if (score >= 70) {
                emoji = 'üëç';
                title = 'Yaxshi!';
                message = 'Yaxshi bilim ko\'rsatdingiz!';
            } else if (score >= 60) {
                emoji = '‚úÖ';
                title = 'O\'tdingiz!';
                message = 'Test muvaffaqiyatli topshirildi!';
            } else {
                emoji = 'üìö';
                title = 'Qayta urinib ko\'ring';
                message = 'Biroz ko\'proq mashq qiling va qaytadan sinab ko\'ring!';
            }

            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('scoreDisplay').textContent = score + '%';
            document.getElementById('resultMessage').textContent = message;

            // Update stats
            document.getElementById('correctCount').textContent = result.correctAnswers;
            document.getElementById('wrongCount').textContent = result.wrongAnswers;
            document.getElementById('totalCount').textContent = result.totalQuestions;

            // Display detailed results
            displayDetailedResults(result.results);
        }

        function displayDetailedResults(results) {
            const container = document.getElementById('detailedResults');
            let html = '';

            results.forEach((r, index) => {
                const isCorrect = r.isCorrect;
                const statusClass = isCorrect ? 'correct' : 'incorrect';
                const statusIcon = isCorrect ? '‚úÖ' : '‚ùå';
                const statusText = isCorrect ? 'To\'g\'ri' : 'Noto\'g\'ri';

                html += `
                    <div style="margin-bottom: var(--spacing-xl); padding-bottom: var(--spacing-xl); border-bottom: 1px solid rgba(148, 163, 184, 0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <h4 style="flex: 1;">Savol ${index + 1}: ${r.question}</h4>
                            <span style="font-size: var(--font-size-2xl); margin-left: var(--spacing-md);">${statusIcon}</span>
                        </div>
                        
                        <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-sm);">
                            <strong>Sizning javobingiz:</strong>
                            <span style="color: ${isCorrect ? '#22c55e' : '#ef4444'}; margin-left: var(--spacing-sm);">
                                ${r.userAnswer !== null && r.userAnswer !== undefined ? 'Variant ' + (r.userAnswer + 1) : 'Javob berilmagan'}
                            </span>
                        </div>

                        ${!isCorrect ? `
                            <div style="background: rgba(34, 197, 94, 0.1); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-sm);">
                                <strong>To'g'ri javob:</strong>
                                <span style="color: #22c55e; margin-left: var(--spacing-sm);">
                                    Variant ${r.correctAnswer + 1}
                                </span>
                            </div>
                        ` : ''}

                        <div style="background: var(--gradient-card); padding: var(--spacing-md); border-radius: var(--radius-md);">
                            <strong>üí° Tushuntirish:</strong>
                            <p style="margin: var(--spacing-sm) 0 0 0; line-height: 1.7; white-space: pre-wrap;">
                                ${r.explanation}
                            </p>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function logout() {
            if (confirm('Rostdan ham chiqmoqchimisiz?')) {
                AppState.logout();
                window.location.href = 'index.html';
            }
        }
    </script>
</body>

</html>