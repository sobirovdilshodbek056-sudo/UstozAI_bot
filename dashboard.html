<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="UstozAI - O'quvchi boshqaruv paneli">
    <title>Dashboard - UstozAI</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-logo">
                <span>üéì</span>
                UstozAI
            </a>
            <ul class="navbar-menu">
                <li><a href="dashboard.html" style="color: var(--color-primary);">Dashboard</a></li>
                <li><a href="chat.html">AI Chat</a></li>
                <li><a href="tests.html">Testlar</a></li>
                <li><a href="subscription.html">Obuna</a></li>
            </ul>
            <div class="navbar-cta">
                <button onclick="logout()" class="btn btn-secondary btn-sm">Chiqish</button>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <section class="section" style="min-height: 100vh; padding-top: 100px;">
        <div class="container">
            <!-- Welcome Header -->
            <div style="margin-bottom: var(--spacing-2xl);">
                <h1>Xush kelibsiz, <span class="text-gradient" id="userName">O'quvchi</span>! üëã</h1>
                <p style="color: var(--text-secondary); font-size: var(--font-size-lg);">
                    Bugungi natijalaringiz va progressingiz
                </p>
            </div>

            <!-- Stats Grid -->
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div class="stat-label">So'ralgan savollar</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="testsCompleted">0</div>
                    <div class="stat-label">Topshirilgan testlar</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="avgScore">0%</div>
                    <div class="stat-label">O'rtacha ball</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="daysActive">0</div>
                    <div class="stat-label">Faol kunlar</div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-2" style="margin-top: var(--spacing-2xl);">
                <!-- Quick Actions -->
                <div class="card">
                    <h3 style="margin-bottom: var(--spacing-lg);">‚ö° Tezkor harakatlar</h3>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                        <a href="chat.html" class="btn btn-primary" style="justify-content: flex-start;">
                            ü§ñ AI bilan suhbat boshlash
                        </a>
                        <a href="tests.html" class="btn btn-outline" style="justify-content: flex-start;">
                            üìù Test topshirish
                        </a>
                        <a href="subscription.html" class="btn btn-secondary" style="justify-content: flex-start;">
                            ‚≠ê Premium ga o'tish
                        </a>
                    </div>
                </div>

                <!-- Progress Card -->
                <div class="card">
                    <h3 style="margin-bottom: var(--spacing-lg);">üìä Haftalik progress</h3>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                        <div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
                                <span>Matematika</span>
                                <span class="text-gradient" style="font-weight: 700;">85%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 85%;"></div>
                            </div>
                        </div>

                        <div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
                                <span>Fizika</span>
                                <span class="text-gradient" style="font-weight: 700;">70%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 70%;"></div>
                            </div>
                        </div>

                        <div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
                                <span>Kimyo</span>
                                <span class="text-gradient" style="font-weight: 700;">60%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%;"></div>
                            </div>
                        </div>

                        <div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
                                <span>Biologiya</span>
                                <span class="text-gradient" style="font-weight: 700;">75%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card" style="margin-top: var(--spacing-2xl);">
                <h3 style="margin-bottom: var(--spacing-lg);">üìö So'nggi faoliyat</h3>
                <div id="recentActivity" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <div
                        style="padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Matematika testi</div>
                            <div style="color: var(--text-muted); font-size: var(--font-size-sm);">Bugun, 14:30</div>
                        </div>
                        <div
                            style="background: var(--gradient-primary); color: white; padding: var(--spacing-xs) var(--spacing-md); border-radius: var(--radius-full); font-weight: 700;">
                            85%
                        </div>
                    </div>

                    <div
                        style="padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Fizika savoli</div>
                            <div style="color: var(--text-muted); font-size: var(--font-size-sm);">Kecha, 18:15</div>
                        </div>
                        <div style="color: var(--color-secondary); font-weight: 700;">
                            ‚úì Javoblandi
                        </div>
                    </div>

                    <div
                        style="padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">Kimyo testi</div>
                            <div style="color: var(--text-muted); font-size: var(--font-size-sm);">2 kun oldin</div>
                        </div>
                        <div
                            style="background: var(--gradient-primary); color: white; padding: var(--spacing-xs) var(--spacing-md); border-radius: var(--radius-full); font-weight: 700;">
                            70%
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscription Info -->
            <div class="card card-gradient" style="margin-top: var(--spacing-2xl); text-align: center;">
                <h3 id="subscriptionTitle">üéâ Bepul sinov davri</h3>
                <p style="font-size: var(--font-size-lg); margin: var(--spacing-md) 0;">
                    <span id="daysLeft">7</span> kun qoldi
                </p>
                <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                    Premium obunaga o'ting va cheksiz imkoniyatlardan foydalaning!
                </p>
                <a href="subscription.html" class="btn btn-primary btn-lg">
                    ‚≠ê Premium ga o'tish
                </a>
            </div>
        </div>
    </section>

    <script src="js/app.js"></script>
    <script>
        // Load user data on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (!AppState.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            const user = AppState.user;
            document.getElementById('userName').textContent = user.name || 'O\'quvchi';

            // Calculate stats from saved data
            const chatCount = AppState.chatHistory.length;
            const testCount = AppState.testResults.length;

            // Calculate average score
            let avgScore = 0;
            if (testCount > 0) {
                const totalScore = AppState.testResults.reduce((sum, test) => sum + (test.score || 0), 0);
                avgScore = Math.round(totalScore / testCount);
            }

            // Calculate days active
            const joinDate = new Date(user.joinDate);
            const today = new Date();
            const daysActive = Math.max(1, Math.floor((today - joinDate) / (1000 * 60 * 60 * 24)));

            // Update stats
            document.getElementById('totalQuestions').textContent = chatCount;
            document.getElementById('testsCompleted').textContent = testCount;
            document.getElementById('avgScore').textContent = avgScore + '%';
            document.getElementById('daysActive').textContent = daysActive;

            // Calculate subscription days left
            if (AppState.subscription) {
                const endDate = new Date(AppState.subscription.endDate);
                const daysLeft = Math.max(0, Math.ceil((endDate - today) / (1000 * 60 * 60 * 24)));
                document.getElementById('daysLeft').textContent = daysLeft;

                if (AppState.subscription.type !== 'free_trial') {
                    document.getElementById('subscriptionTitle').textContent = '‚≠ê Premium obuna';
                }
            }
        });

        function logout() {
            if (confirm('Rostdan ham chiqmoqchimisiz?')) {
                AppState.logout();
                showNotification('Tizimdan chiqdingiz', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            }
        }
    </script>
</body>

</html>